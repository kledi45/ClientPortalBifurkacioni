<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - e-Bifurkacioni</title>

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/ClientPortalBifurkacioni.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <script src="~/js/jquery-3.2.1.min.js"></script>
    <script src="~/js/moment.min.js"></script>
    <script src="~/js/bootstrap.min.js"></script>
</head>
<body class="d-flex flex-column min-vh-100">

    <div id="overlay">
        <div class="loader-container">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Duke ngarkuar...</span>
            </div>
            <div class="loader-text">Duke u ngarkuar...</div>
        </div>
    </div>

    <!-- Header Navigation -->
    <header style="background-color: #3C8CCB;" class="py-3">
        <div class="container d-flex align-items-center justify-content-between">
            <img src="~/images/logo.png" alt="Bifurkacioni Logo" style="height: 50px;" class="img-fluid" />

            <nav class="d-flex align-items-center gap-4">
                <a href="@Url.Action("Index", "Home")"
                   class="text-white fw-semibold text-decoration-none @(ViewContext.RouteData.Values["controller"]?.ToString() == "Home" && ViewContext.RouteData.Values["action"]?.ToString() == "Index" ? "border-bottom border-white border-2" : "")">
                    Kartela ime
                </a>
                <a href="@Url.Action("Properties", "Home")"
                   class="text-white fw-semibold text-decoration-none @(ViewContext.RouteData.Values["controller"]?.ToString() == "Home" && ViewContext.RouteData.Values["action"]?.ToString() == "Properties" ? "border-bottom border-white border-2" : "")">
                    Shto pronë
                </a>
               @*  <a href="@Url.Action("CRM", "Home")"
                   class="text-white fw-semibold text-decoration-none @(ViewContext.RouteData.Values["controller"]?.ToString() == "Home" && ViewContext.RouteData.Values["action"]?.ToString() == "CRM" ? "border-bottom border-white border-2" : "")">
                    Kërkesë / Ankesë
                </a> *@
                <div class="dropdown d-flex align-items-center gap-2 border-start ps-3">
                    <span class="text-white fw-semibold">@User.Identity?.Name</span>
                    <button class="btn btn-sm bg-white rounded-circle dropdown-toggle p-0 border-0" type="button" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false" style="width: 32px; height: 32px;">
                        <i class="bi bi-person" style="color: #3C8CCB;"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                        <li><a class="dropdown-item text-danger" href="#" id="signOutBtn">Sign Out</a></li>
                    </ul>
                </div>
            </nav>
        </div>
    </header>

    <main class="flex-fill">
        <div class="container py-4">
            @RenderBody()
        </div>
    </main>

    <footer class="bg-light text-center text-muted py-3 mt-auto">
        <div class="container">
            &copy; 2025 Integrated Water Billing - <strong>Bifurkacioni</strong>
        </div>
    </footer>

    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js" asp-append-version="true"></script>
    <script src="~/js/ajax.js" asp-append-version="true"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/requests.js" asp-append-version="true"></script>
    <script src="~/js/app.js" asp-append-version="true"></script>
    <script src="~/js/jquery-validator.js"></script>
    <script>
        $(document).ajaxError(function (event, xhr) {
            if (xhr.status === 401) {
                window.location.href = '/';
            }
        });

        $("#signOutBtn").on("click", function (e) {
            e.preventDefault();

            $.post("@Url.Action("Signout", "Auth")", function () {
                // Clear access_token cookie manually (client-side fallback)
                document.cookie = "access_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";

                // Redirect to homepage
                window.location.href = "/";
            });
        });
    </script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
